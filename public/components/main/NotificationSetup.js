import React, { Component, Fragment } from 'react'
import {
    EuiSpacer,
    EuiFlexGroup,
    EuiFlexItem,
    EuiForm,
    EuiButton,
    EuiButtonEmpty,
    EuiFieldText,
    EuiFormRow,
    EuiModal,
    EuiModalBody,
    EuiModalFooter,
    EuiOverlayMask,
    EuiModalHeader,
    EuiModalHeaderTitle,

} from "@elastic/eui"

export class NotificationSetup extends Component {

    constructor(props) {
        super(props);
        this.httpClient = this.props.httpClient;
        this.state = {
            isModalVisible: false,
            medium: null,
            notificationLabel: null,
            id: null
        };
    }

    closeModal = () => {
        this.setState({ isModalVisible: false });
    }

    showModal = () => {
        this.setState({ isModalVisible: true });
    }

    getNotificationCredentials = async () => {
        let resp = await this.httpClient.get("../api/absythe/notificationSetup");
        if(resp !== undefined){
            let data = resp.data;
            let id = data[this.state.medium];
            this.setState( {id: id === undefined ? null : id} );
        }
    }

    onGmailIconClick = () => {
        this.setState({ medium: "gmail", notificationLabel: "Email Address" });
        this.getNotificationCredentials();
        this.showModal();
    }

    onSlackIconClick = () => {
        this.setState({ medium: "slack", notificationLabel: "Slack Id"});
        this.getNotificationCredentials();
        this.showModal();
    }

    onDiscordIconClick = () => {
        this.setState({ medium: "discord", notificationLabel: "Discord Username" });
        this.getNotificationCredentials();
        this.showModal();
    }

    saveNotificationSetup = async () => {
        const { medium, id } = this.state;
        if(medium !== null && id !== null){
            let resp = await this.httpClient.post(`../api/absythe/notificationSetup`, {
                medium: medium,
                id: id
            });
            if (resp !== undefined){
                console.log(resp.data);
            }
        }
        this.closeModal();
    }

    onNotificationIdChange = (e) => {
        this.setState( {id: e.target.value} );
    }

    render() {
        const form = (
            <EuiForm>    
              <EuiFormRow label={this.state.notificationLabel}>
                <EuiFieldText name="notificationId" value={this.state.id} onChange={this.onNotificationIdChange}/>
              </EuiFormRow>
            </EuiForm>
        );

        let modal;

        if(this.state.isModalVisible){
            modal = (
                <EuiOverlayMask>
                  <EuiModal onClose={this.closeModal} initialFocus="[name=notificationId]">
                    <EuiModalHeader>
                      <EuiModalHeaderTitle>Notification Setup</EuiModalHeaderTitle>
                    </EuiModalHeader>
        
                    <EuiModalBody>{form}</EuiModalBody>
        
                    <EuiModalFooter>
                      <EuiButtonEmpty onClick={this.closeModal}>Cancel</EuiButtonEmpty>
        
                      <EuiButton onClick={this.saveNotificationSetup} fill>
                        Save
                      </EuiButton>
                    </EuiModalFooter>
                  </EuiModal>
                </EuiOverlayMask>
              );
        }

        return (
            <Fragment>
                <EuiSpacer />
                <EuiFlexGroup style={{ width: 600, margin: "auto" }}>
                    <EuiFlexItem style={{ textAlign: "center" }}>
                        <svg onClick={this.onGmailIconClick} style={{ position: "relative", top: -10 }} className="notification-setup--icons" id='Layer_1' xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512' height="128px" width="128px">
                            <g fill='#f2f2f2'>
                                <polygon points='445.244,159.1 445.244,444.019 66.756,444.019 66.756,159.1 256,297.033'
                                />
                                <polygon points='466.067,67.981 256,221.091 45.933,67.981 256,67.981'
                                />
                            </g>
                            <g fill='#f14336'>
                                <path d='M66.756,159.1v284.919H32.459c-12.849,0-23.273-10.424-23.273-23.273V117.135L66.756,159.1z'
                                />
                                <path d='M502.813,91.254v25.882L445.244,159.1L256,297.033L66.756,159.1L9.187,117.135V91.254 c0-12.849,10.424-23.273,23.273-23.273h13.474L256,221.091l210.067-153.11h13.461C492.39,67.981,502.813,78.405,502.813,91.254z'
                                />
                            </g>
                            <path d='M502.813,117.135v303.611c0,12.849-10.424,23.273-23.285,23.273h-34.284V159.1L502.813,117.135z'
                                fill='#d32e2a' />
                            <path d='M479.528,58.794H32.459C14.561,58.794,0,73.356,0,91.254v329.493	c0,17.898,14.561,32.459,32.459,32.459h447.069c17.905,0,32.472-14.561,32.472-32.459V91.254	C512,73.356,497.434,58.794,479.528,58.794z M437.867,77.167L256,209.723L74.133,77.167H437.867z M18.373,420.746V135.2	l39.196,28.569v271.064h-25.11C24.692,434.833,18.373,428.513,18.373,420.746z M436.057,434.833H75.943V177.161L250.59,304.457	c1.611,1.175,3.511,1.763,5.41,1.763c1.9,0,3.8-0.588,5.41-1.763l174.647-127.297V434.833z M493.627,420.746	c0,7.767-6.324,14.086-14.098,14.086h-25.098V163.769l39.196-28.569V420.746z M493.627,112.464L256,285.665L18.373,112.464v-21.21	c0-7.767,6.319-14.086,14.086-14.086h10.481L250.59,228.515c1.612,1.175,3.51,1.763,5.41,1.763c1.9,0,3.798-0.588,5.41-1.763	L469.059,77.167h10.469c7.774,0,14.098,6.319,14.098,14.086V112.464z'
                                fill='#333' />
                        </svg>
                        <h4>Email</h4>
                    </EuiFlexItem>
                    <EuiFlexItem style={{ textAlign: "center" }}>
                        <svg onClick={this.onSlackIconClick} style={{ position: "relative", top: -14.68 }} className="notification-setup--icons" id='Capa_1' xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512' height="128px" width="128px">
                            <circle cx='256' cy='256' r='256' fill='#696e73' />
                            <path d='M510.908,232.417L400.616,122.125c-8.598-12.3-24.536-18.073-39.517-13.125l-13.264,4.38	l-42.742-42.742c-9.012-9.384-22.934-13.326-36.113-8.974c-18.29,6.04-28.222,25.763-22.182,44.055l12.214,36.99l0,0l-50.128,16.552	l-41.291-41.291c-8.866-10.908-23.855-15.793-37.996-11.124c-18.29,6.04-28.222,25.763-22.182,44.055l12.465,37.75l-36.033,11.898	c-18.291,6.04-28.223,25.763-22.183,44.055c1.526,4.622,3.929,8.708,6.958,12.139l0,0c0.931,1.055,1.926,2.042,2.97,2.97	l74.565,74.565l-17.127,5.656c-18.291,6.04-28.223,25.763-22.183,44.055c1.69,5.115,4.449,9.576,7.949,13.217l-0.006,0.006	l113.264,113.264C237.233,511.472,246.555,512,256,512c141.385,0,256-114.615,256-256C512,248.047,511.618,240.185,510.908,232.417z'
                                fill='#50555a' />
                            <path d='M338.347,382.971l-91.549-277.253c-6.04-18.291,3.892-38.015,22.182-44.055	c18.292-6.039,38.015,3.892,44.055,22.183L404.584,361.1c6.04,18.291-3.892,38.015-22.183,44.055	C364.115,411.193,344.389,401.266,338.347,382.971z'
                                fill='#ffc305' />
                            <path d='M198.963,428.154l-91.549-277.253c-6.04-18.291,3.892-38.015,22.182-44.055	c18.29-6.039,38.015,3.892,44.055,22.183L265.2,406.283c6.04,18.291-3.892,38.015-22.182,44.055	C224.723,456.376,205.003,446.443,198.963,428.154z'
                                fill='#7daf93' />
                            <path d='M106.846,383.987c-6.04-18.291,3.892-38.015,22.183-44.055l277.254-91.549	c18.289-6.041,38.015,3.893,44.055,22.182c6.04,18.291-3.892,38.015-22.183,44.055L150.901,406.17	C132.605,412.21,112.885,402.277,106.846,383.987z'
                                fill='#e1325a' />
                            <rect x='175.015' y='315.069' transform='rotate(-18.268 209.904 349.937)'
                                width='69.756' height='69.756' fill='#1b444f' />
                            <rect x='314.141' y='269.126' transform='rotate(-18.268 349.027 303.99)'
                                width='69.756' height='69.756' fill='#e64b55' />
                            <path d='M61.664,244.603c-6.04-18.291,3.892-38.015,22.183-44.055L361.101,109	c18.29-6.04,38.015,3.892,44.055,22.182c6.04,18.291-3.892,38.015-22.183,44.055l-277.254,91.55	C87.423,272.826,67.702,262.893,61.664,244.603z'
                                fill='#91cdff' />
                            <rect x='129.059' y='175.933' transform='rotate(-18.268 163.943 210.804)'
                                width='69.756' height='69.756' fill='#51946f' />
                            <rect x='268.188' y='130' transform='rotate(-18.268 303.07 164.866)' width='69.756'
                                height='69.756' fill='#82962d' />
                        </svg>
                        <h4>Slack</h4>
                    </EuiFlexItem>
                    <EuiFlexItem style={{ textAlign: "center" }}>
                        <svg onClick={this.onDiscordIconClick} style={{ position: "relative", top: -14.68 }} className="notification-setup--icons" id='Layer_1' xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512' height="128px" width="128px">
                            <circle cx='256.313' cy='256' r='247.916' fill='#a8adf0' />
                            <path d='M256.318,8.084c-10.96,0-21.752,0.72-32.337,2.099C345.622,26.029,439.56,130.04,439.56,256	s-93.939,229.971-215.579,245.817c10.585,1.379,21.377,2.099,32.337,2.099c136.92,0,247.916-110.996,247.916-247.916	S393.239,8.084,256.318,8.084z'
                                fill='#989fec' />
                            <path d='M413.033,118.65l-1.224-3.104c-0.036-0.089-0.105-0.163-0.193-0.203l-3.039-1.38	c-25.016-11.362-60.303-14.166-91.523-15.409h-35.163c-0.397,0-0.518,0.537-0.161,0.708l72.229,34.627	c0.407,0.195,0.182,0.801-0.255,0.687c-32.485-8.481-65.3-12.775-97.704-12.775c-32.3,0-65.009,4.267-97.393,12.697	c-0.441,0.114-0.664-0.499-0.251-0.69l74.763-34.541c0.362-0.167,0.244-0.71-0.156-0.71h-38.017	c-31.219,1.243-66.507,4.046-91.523,15.409l-3.039,1.38c-0.088,0.04-0.157,0.112-0.193,0.203l-1.224,3.104	c-25.6,64.873-32.875,175.001-25.117,243.992l0.406,3.618l2.878,2.232c39.994,31.013,93.471,46.957,127.113,51.189l4.35,0.548	c1.414,0.178,2.765-0.639,3.265-1.974l21.896-58.5c0.682-1.824-0.48-3.815-2.403-4.116l-6.719-1.055	c-23.428-3.681-56.621-13.439-84.673-38.875c-0.599-0.543-0.022-1.522,0.737-1.241c2.279,0.847,4.79,1.828,7.377,2.839	c6.343,2.478,12.903,5.04,17.184,6.058c30.084,7.152,60.591,10.779,90.737,10.779v-0.537h0.063l0.004,0.537	c30.085,0,60.591-3.627,90.67-10.78c4.282-1.018,10.843-3.58,17.187-6.059c2.586-1.01,5.096-1.991,7.373-2.837	c0.759-0.282,1.337,0.697,0.737,1.241c-27.957,25.325-61.191,35.056-84.672,38.734l-6.717,1.052	c-1.923,0.301-3.087,2.291-2.406,4.114l21.9,58.644c0.499,1.336,1.851,2.154,3.265,1.976l4.354-0.548	c33.64-4.231,87.113-20.176,127.109-51.189l2.878-2.232l0.406-3.618C445.908,293.651,438.633,183.522,413.033,118.65z M184.533,277.919c-27.195,2.425-49.885-20.262-47.463-47.459c1.857-20.848,18.644-37.636,39.492-39.495	c27.195-2.425,49.885,20.262,47.463,47.459C222.167,259.271,205.38,276.06,184.533,277.919z M335.439,277.919	c-27.195,2.425-49.885-20.262-47.463-47.459c1.857-20.848,18.644-37.636,39.492-39.495c27.195-2.425,49.885,20.262,47.463,47.459	C373.072,259.271,356.285,276.06,335.439,277.919z'
                                fill='#fff' />
                            <path d='M437.019,74.982C388.667,26.628,324.379,0,256,0S123.333,26.628,74.981,74.982C26.628,123.333,0,187.62,0,256	s26.628,132.667,74.981,181.019C123.333,485.372,187.62,512,256,512s132.667-26.628,181.019-74.982	C485.372,388.667,512,324.379,512,256S485.372,123.333,437.019,74.982z M256,495.832C123.756,495.832,16.168,388.244,16.168,256	S123.756,16.168,256,16.168S495.832,123.756,495.832,256S388.244,495.832,256,495.832z'
                            />
                            <path d='M432.352,291.429c0.482,25.568-0.469,49.778-2.77,70.251c-36.435,28.254-87.47,44.992-122.901,49.448l-17.987-48.164	c24.924-3.903,62.879-14.828,93.67-45.155c2.644-2.605,3.176-6.674,1.288-9.87c-1.886-3.196-5.707-4.693-9.264-3.639	c-3.636,1.081-8.478,2.973-13.605,4.976c-5.788,2.261-12.349,4.824-16.042,5.701c-29.431,6.999-59.262,10.546-88.676,10.546	c-0.019,0-0.067,0-0.067,0h-0.064c-29.413,0-59.246-3.548-88.677-10.546c-3.692-0.877-10.253-3.44-16.041-5.701	c-4.932-1.927-9.601-3.751-13.186-4.849c-3.335-1.022-7.068-0.044-9.167,2.741c-2.477,3.287-2.09,7.822,0.772,10.642	c30.9,30.434,68.793,41.387,93.665,45.294l-17.975,48.023c-35.429-4.456-86.47-21.195-122.905-49.448	c-7.617-67.754-0.462-176.432,24.57-239.864c22.942-10.42,56.646-13.383,88.3-14.644l-50.48,23.408	c-3.833,1.776-5.651,6.207-4.173,10.165c1.48,3.958,5.757,6.109,9.816,4.936c35.034-10.12,70.545-15.253,105.547-15.253	s70.514,5.133,105.547,15.253c4.055,1.168,8.336-0.979,9.816-4.936c1.48-3.958-0.338-8.387-4.173-10.165l-50.48-23.408	c31.655,1.261,65.358,4.224,88.3,14.644c13.691,34.694,22.033,82.921,25.536,130.586c0.311,4.243,3.855,7.518,8.109,7.518h0.03	c4.734,0,8.467-4.024,8.121-8.745c-3.7-50.491-12.816-101.545-28.002-138.382c-0.744-1.803-2.114-3.278-3.86-4.15	c-32.14-16.067-82.437-17.359-122.854-18.399c-4.946-0.127-9.726-0.249-14.276-0.396c-3.836-0.112-7.237,2.474-8.125,6.213	c-0.888,3.738,0.979,7.585,4.465,9.201l24.607,11.411c-14.289-1.607-28.564-2.416-42.763-2.416s-28.475,0.808-42.764,2.416	l24.607-11.411c3.486-1.616,5.353-5.463,4.465-9.201c-0.887-3.739-4.279-6.321-8.125-6.213c-4.55,0.147-9.329,0.268-14.276,0.396	c-40.416,1.039-90.715,2.331-122.854,18.399c-1.745,0.872-3.116,2.347-3.86,4.15C65.45,180.095,57.964,294.856,66.754,366.924	c0.254,2.089,1.313,3.995,2.951,5.315c41.525,33.475,100.37,52.072,140.266,55.653c0.244,0.023,0.486,0.032,0.726,0.032	c3.344,0,6.378-2.072,7.567-5.25l23.747-63.444c1.165-3.11,0.329-6.702-2.326-8.994c-1.3-1.122-2.961-1.732-4.669-1.907	c-12.462-1.273-31.326-4.622-51.2-13.33c24.025,4.446,48.197,6.694,72.118,6.694h0.064c0.001,0,0.002,0,0.002,0h0.065	c23.812,0,47.877-2.227,71.793-6.634c-19.722,8.547-38.452,11.858-50.864,13.127c-1.708,0.175-3.37,0.783-4.672,1.901	c-2.661,2.287-3.501,5.882-2.338,8.995l23.747,63.587c1.188,3.182,4.223,5.256,7.569,5.256c0.241,0,0.484-0.011,0.727-0.032	c39.897-3.581,98.742-22.178,140.266-55.653c1.638-1.32,2.696-3.226,2.951-5.315c2.697-22.114,3.86-48.251,3.376-75.801	c-0.078-4.436-3.704-7.994-8.14-7.994l0,0C435.926,283.131,432.266,286.874,432.352,291.429z'
                            />
                            <path d='M180.547,183.242c-28.231,0-51.2,22.969-51.2,51.2s22.969,51.2,51.2,51.2s51.2-22.969,51.2-51.2	S208.778,183.242,180.547,183.242z M180.547,269.474c-19.316,0-35.032-15.715-35.032-35.032s15.716-35.032,35.032-35.032	s35.032,15.715,35.032,35.032S199.863,269.474,180.547,269.474z'
                            />
                            <path d='M331.453,183.242c-28.231,0-51.2,22.969-51.2,51.2s22.969,51.2,51.2,51.2c28.231,0,51.2-22.969,51.2-51.2	S359.684,183.242,331.453,183.242z M331.453,269.474c-19.316,0-35.032-15.715-35.032-35.032s15.716-35.032,35.032-35.032	s35.032,15.715,35.032,35.032S350.768,269.474,331.453,269.474z'
                            />
                        </svg>
                        <h4>Discord</h4>
                    </EuiFlexItem>
                </EuiFlexGroup>
                {modal}
            </Fragment>
        )
    }
}

export default NotificationSetup
